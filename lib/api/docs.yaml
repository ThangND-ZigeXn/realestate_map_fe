---
openapi: 3.0.1
info:
  title: Rental Search API V1
  version: v1
  description: API for searching rental rooms on map with PostGIS support
  contact:
    name: API Support
paths:
  "/api/v1/addresses/suggest":
    get:
      summary: Get address suggestions
      tags:
        - Addresses
      description: Get address autocomplete suggestions using Mapbox Geocoding API
      parameters:
        - name: q
          in: query
          required: true
          description: Search query (minimum 2 characters)
          schema:
            type: string
        - name: query
          in: query
          required: false
          description: Alternative parameter name for search query (alias of q)
          schema:
            type: string
        - name: limit
          in: query
          required: false
          description: "Maximum number of suggestions to return (default: 5, max: 10)"
          schema:
            type: integer
        - name: country
          in: query
          required: false
          description: "Country code to limit results (default: vn)"
          schema:
            type: string
      responses:
        "200":
          description: successful
          content:
            application/json:
              examples:
                example_suggestions:
                  value:
                    query: bình thạnh
                    suggestions:
                      - id: place.123456
                        text: Bình Thạnh
                        place_name: Bình Thạnh, Ho Chi Minh City, Vietnam
                        latitude: 10.811195
                        longitude: 106.70457
                        place_type: locality
                        address_components:
                          district: Bình Thạnh
                          region: Ho Chi Minh City
                        relevance: 0.99
              schema:
                type: object
                properties:
                  query:
                    type: string
                    example: bÃ¬nh tháº¡nh
                  suggestions:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                          example: place.123456
                        text:
                          type: string
                          example: Bình Thạnh
                        place_name:
                          type: string
                          example: Bình Thạnh, Ho Chi Minh City, Vietnam
                        latitude:
                          type: number
                          example: 10.811195
                        longitude:
                          type: number
                          example: 106.70457
                        place_type:
                          type: string
                          example: locality
                        address_components:
                          type: object
                          properties:
                            district:
                              type: string
                              example: Bình Thạnh
                            region:
                              type: string
                              example: Ho Chi Minh City
                            locality:
                              type: string
                        relevance:
                          type: number
                          example: 0.99
        "400":
          description: bad request - geocoding error
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
  "/api/v1/room_images/random":
    get:
      summary: Get random room image
      tags:
        - Room Images
      description: Get a random room image URL based on room type (room, studio, apartment)
      parameters:
        - name: type
          in: query
          required: false
          description:
            Room type (room, studio, apartment). If not provided, returns
            random image from all types.
          schema:
            type: string
            enum:
              - room
              - studio
              - apartment
      responses:
        "200":
          description: successful - no type specified
          content:
            application/json:
              examples:
                example_random_image:
                  value:
                    image_url: http://ecogreen-saigon.vn/uploads/phong-tro-la-loai-hinh-nha-o-pho-bien-gia-re-tien-loi-cho-sinh-vien-va-nguoi-di-lam.png
                    type: room
                    timestamp: "2024-01-15T10:30:00Z"
              schema:
                type: object
                properties:
                  image_url:
                    type: string
                    example: http://ecogreen-saigon.vn/uploads/phong-tro-la-loai-hinh-nha-o-pho-bien-gia-re-tien-loi-cho-sinh-vien-va-nguoi-di-lam.png
                  type:
                    type: string
                    nullable: true
                    example: room
                  timestamp:
                    type: string
                    format: date-time
                    example: "2024-01-15T10:30:00Z"
                required:
                  - image_url
                  - timestamp
  "/api/v1/room_images/list":
    get:
      summary: List all room images by type
      tags:
        - Room Images
      description:
        Get all available room images organized by room type. Useful for
        debugging or getting all image URLs.
      responses:
        "200":
          description: successful
          content:
            application/json:
              examples:
                example_list_images:
                  value:
                    images_by_type:
                      room:
                        - http://ecogreen-saigon.vn/uploads/phong-tro-la-loai-hinh-nha-o-pho-bien-gia-re-tien-loi-cho-sinh-vien-va-nguoi-di-lam.png
                      studio: []
                      apartment: []
              schema:
                type: object
                properties:
                  images_by_type:
                    type: object
                    properties:
                      room:
                        type: array
                        items:
                          type: string
                        example:
                          - http://ecogreen-saigon.vn/uploads/phong-tro-la-loai-hinh-nha-o-pho-bien-gia-re-tien-loi-cho-sinh-vien-va-nguoi-di-lam.png
                      studio:
                        type: array
                        items:
                          type: string
                      apartment:
                        type: array
                        items:
                          type: string
                required:
                  - images_by_type
  "/api/v1/room_viewings":
    post:
      summary: Create room viewing appointment
      tags:
        - Room Viewings
      description: Create a new room viewing appointment
      parameters: []
      responses:
        "201":
          description: room viewing created
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                    example: 1
                  room_id:
                    type: integer
                    example: 1
                  name:
                    type: string
                    example: Nguyễn Văn A
                  email:
                    type: string
                    example: nguyenvana@example.com
                  phone:
                    type: string
                    example: "0901234567"
                  preferred_date:
                    type: string
                    format: date-time
                    example: "2026-02-15T14:00:00Z"
                  message:
                    type: string
                    example: Tôi muốn xem phòng vào buổi chiều
                  status:
                    type: string
                    example: pending
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
                required:
                  - id
                  - room_id
                  - name
                  - email
                  - phone
                  - preferred_date
                  - status
        "422":
          description: validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                room_id:
                  type: integer
                  example: 1
                name:
                  type: string
                  example: Nguyễn Văn A
                email:
                  type: string
                  example: nguyenvana@example.com
                phone:
                  type: string
                  example: "0901234567"
                preferred_date:
                  type: string
                  format: date-time
                  example: "2026-02-15T14:00:00Z"
                message:
                  type: string
                  example: Tôi muốn xem phòng vào buổi chiều
              required:
                - room_id
                - name
                - email
                - phone
                - preferred_date
    get:
      summary: List room viewings
      tags:
        - Room Viewings
      description: Get a list of room viewing appointments with optional filters
      parameters:
        - name: room_id
          in: query
          required: false
          description: Filter by room ID
          schema:
            type: integer
        - name: status
          in: query
          required: false
          description: Filter by status
          schema:
            type: string
            enum:
              - pending
              - confirmed
              - cancelled
              - completed
        - name: page
          in: query
          required: false
          description: "Page number (default: 1)"
          schema:
            type: integer
        - name: per_page
          in: query
          required: false
          description: "Items per page (default: 20, max: 100)"
          schema:
            type: integer
      responses:
        "200":
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: integer
                        room_id:
                          type: integer
                        name:
                          type: string
                        email:
                          type: string
                        phone:
                          type: string
                        preferred_date:
                          type: string
                          format: date-time
                        message:
                          type: string
                          nullable: true
                        status:
                          type: string
                        created_at:
                          type: string
                          format: date-time
                        updated_at:
                          type: string
                          format: date-time
                  meta:
                    type: object
                    properties:
                      current_page:
                        type: integer
                      per_page:
                        type: integer
                      total_pages:
                        type: integer
                      total_count:
                        type: integer
                required:
                  - data
                  - meta
  "/api/v1/room_viewings/{id}":
    get:
      summary: Show room viewing
      tags:
        - Room Viewings
      description: Get details of a specific room viewing appointment
      parameters:
        - name: id
          in: path
          required: true
          description: Room viewing ID
          schema:
            type: integer
      responses:
        "200":
          description: successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  room_id:
                    type: integer
                  room:
                    type: object
                    properties:
                      id:
                        type: integer
                      title:
                        type: string
                      address:
                        type: string
                        nullable: true
                      price:
                        type: integer
                  name:
                    type: string
                  email:
                    type: string
                  phone:
                    type: string
                  preferred_date:
                    type: string
                    format: date-time
                  message:
                    type: string
                    nullable: true
                  status:
                    type: string
                  created_at:
                    type: string
                    format: date-time
                  updated_at:
                    type: string
                    format: date-time
                required:
                  - id
                  - room_id
                  - name
                  - email
                  - phone
                  - preferred_date
                  - status
        "404":
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
    patch:
      summary: Update room viewing status
      tags:
        - Room Viewings
      description: Update the status of a room viewing appointment
      parameters:
        - name: id
          in: path
          required: true
          description: Room viewing ID
          schema:
            type: integer
      responses:
        "200":
          description: room viewing updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: integer
                  status:
                    type: string
                  updated_at:
                    type: string
                    format: date-time
                required:
                  - id
                  - status
        "404":
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
        "422":
          description: validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  errors:
                    type: object
                    additionalProperties:
                      type: array
                      items:
                        type: string
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                    - pending
                    - confirmed
                    - cancelled
                    - completed
                  example: confirmed
              required:
                - status
  "/api/v1/rooms":
    get:
      summary: List rooms
      tags:
        - Rooms
      description:
        Get a list of rental rooms with optional geographic and attribute
        filters
      parameters:
        - name: address
          in: query
          required: false
          description: Address to search around (e.g., "Quận Đống Đa, Hà Nội")
          schema:
            type: string
        - name: address_radius
          in: query
          required: false
          description:
            "Search radius in meters when using address (default: 5000, max:
            50000)"
          schema:
            type: integer
        - name: north
          in: query
          required: false
          description: Northern latitude for bounding box search
          schema:
            type: number
        - name: south
          in: query
          required: false
          description: Southern latitude for bounding box search
          schema:
            type: number
        - name: east
          in: query
          required: false
          description: Eastern longitude for bounding box search
          schema:
            type: number
        - name: west
          in: query
          required: false
          description: Western longitude for bounding box search
          schema:
            type: number
        - name: lat
          in: query
          required: false
          description: Latitude for radius search
          schema:
            type: number
        - name: lng
          in: query
          required: false
          description: Longitude for radius search
          schema:
            type: number
        - name: radius
          in: query
          required: false
          description: "Radius in meters for radius search (max: 50000)"
          schema:
            type: integer
        - name: min_price
          in: query
          required: false
          description: Minimum price filter
          schema:
            type: integer
        - name: max_price
          in: query
          required: false
          description: Maximum price filter
          schema:
            type: integer
        - name: min_area
          in: query
          required: false
          description: Minimum area filter (m²)
          schema:
            type: number
        - name: max_area
          in: query
          required: false
          description: Maximum area filter (m²)
          schema:
            type: number
        - name: room_type
          in: query
          required: false
          description:
            "Filter by room type:\n * `room` \n * `studio` \n * `apartment`
            \n "
          schema:
            type: string
            enum:
              - room
              - studio
              - apartment
        - name: status
          in: query
          required: false
          description: Filter by status
          schema:
            type: string
            enum:
              - available
              - rented
      responses:
        "200":
          description: successful
          content:
            application/json:
              examples:
                example_without_filters:
                  value:
                    type: FeatureCollection
                    features:
                      - type: Feature
                        geometry:
                          type: Point
                          coordinates:
                            - 105.8542
                            - 21.0285
                        properties:
                          id: 1
                          title: Studio cozy gần Hồ Tây
                          price: 3500000
                          area: 25.0
                          address: 100 Đường ABC, Quận Đống Đa, Hà Nội
                          roomType: studio
                          status: available
                          description: Phòng studio tại...
                          phone: "02438345678"
                          phoneFormatted: "(024) 3834-5678"
              schema:
                "$ref": "#/components/schemas/GeoJSONFeatureCollection"
        "400":
          description: bad request
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
  "/api/v1/rooms/{id}":
    get:
      summary: Show room
      tags:
        - Rooms
      description: Get details of a specific room
      parameters:
        - name: id
          in: path
          required: true
          description: Room ID
          schema:
            type: integer
      responses:
        "200":
          description: successful
          content:
            application/json:
              examples:
                example_room:
                  value:
                    type: Feature
                    geometry:
                      type: Point
                      coordinates:
                        - 105.8542
                        - 21.0285
                    properties:
                      id: 1
                      title: Studio cozy gần Hồ Tây
                      price: 3500000
                      area: 25.0
                      address: 100 Đường ABC, Quận Đống Đa, Hà Nội
                      roomType: studio
                      status: available
                      description: Phòng studio tại...
                      phone: "02438345678"
                      phoneFormatted: "(024) 3834-5678"
              schema:
                "$ref": "#/components/schemas/GeoJSONFeature"
        "404":
          description: not found
          content:
            application/json:
              schema:
                "$ref": "#/components/schemas/Error"
servers:
  - url: http://localhost:3000
    description: Development server
components:
  schemas:
    GeoJSONFeature:
      type: object
      properties:
        type:
          type: string
          example: Feature
        geometry:
          type: object
          properties:
            type:
              type: string
              example: Point
            coordinates:
              type: array
              items:
                type: number
              example:
                - 105.8542
                - 21.0285
        properties:
          type: object
          properties:
            id:
              type: integer
            title:
              type: string
            price:
              type: integer
            area:
              type: number
              nullable: true
            address:
              type: string
              nullable: true
            roomType:
              type: string
              enum:
                - room
                - studio
                - apartment
            status:
              type: string
              enum:
                - available
                - rented
            description:
              type: string
              nullable: true
            phone:
              type: string
              nullable: true
            phoneFormatted:
              type: string
              nullable: true
    GeoJSONFeatureCollection:
      type: object
      properties:
        type:
          type: string
          example: FeatureCollection
        features:
          type: array
          items:
            "$ref": "#/components/schemas/GeoJSONFeature"
    Error:
      type: object
      properties:
        error:
          type: string
